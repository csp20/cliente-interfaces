<html>

<head>
    <title>Prueba 1</title>
    <style type="text/css">
        #nombreError {
            display: none;
            font-size: 0.8em;
        }

        #nombreError.visible {
            display: block;
        }

        #tlfnError {
            display: none;
            font-size: 0.8em;
        }

        #tlfnError.visible {
            display: block;
        }

        input.invalido {
            border-color: red;
        }
    </style>
</head>

<body>
    <form id="form">
        <label for="nombre"> Nombre* </label>
        <input type="text" name="nombre" id="nombre" />
        <span role="alert" id="nombreError" aria-hidden="true">
            Ingrese su nombre, por favor
        </span>
        <br><br>
        <label for="tlfn"> telefono* </label>
        <input type="text" name="tlfn" id="tlfn" />
        <span role="alert" id="tlfnError" aria-hidden="true">
            Ingrese su tlfn, por favor
        </span>
        <br><br>
        <button id="enviar">Enviar</button>
    </form>
    <script>
        const enviar = document.getElementById("enviar");

        enviar.addEventListener("click", validar);

        function validar(e) {
            e.preventDefault();

            const campoNombre = document.getElementById("nombre");
            const campotlfn = document.getElementById("tlfn");
            //let valido = true;

            if (!campoNombre.value) {
                const nombreError = document.getElementById("nombreError");
                nombreError.classList.add("visible");
                campoNombre.classList.add("invalido");
                nombreError.setAttribute("aria-hidden", false);
                nombreError.setAttribute("aria-invalid", true);
            } else {
                const nombreError = document.getElementById("nombreError");
                nombreError.classList.remove("visible");
                campoNombre.classList.remove("invalido");
                nombreError.setAttribute("aria-hidden", true);
                nombreError.setAttribute("aria-invalid", false);
            }
            //return valido;
            if (!campotlfn.value) {
                const tlfnError = document.getElementById("tlfnError");
                tlfnError.classList.add("visible");
                campotlfn.classList.add("invalido");
                tlfnError.setAttribute("aria-hidden", false);
                tlfnError.setAttribute("aria-invalid", true);
            } else {
                const tlfnError = document.getElementById("tlfnError");
                tlfnError.classList.remove("visible");
                campotlfn.classList.remove("invalido");
                tlfnError.setAttribute("aria-hidden", true);
                tlfnError.setAttribute("aria-invalid", false);
            }
        }

        const oneMegaBytesInBytes = 10 ** 6;
        const pesoLimite = oneMegaBytesInBytes * 2; // 2 megabyte
        const extensionesPermitidas = ['jpg', 'jpeg', 'png'];
        const miInput = document.querySelector('#foto');

        function validarImagen() {
            // Resetea mensaje
            miInput.setCustomValidity('');

            // Destructuramos para obtener el nombre y el tamaño
            const { name: archivoNombre, size: archivoPeso } = this.files[0];


            // Obtenemos la extensión
            
            const fileExtension = archivoNombre.split(".").pop();

            // Validamos si tienes una extensión válida
            if (!extensionesPermitidas.includes(fileExtension)) {
                miInput.setCustomValidity('Formato no válido, solo se admite jpg y png');
            }

            // Validamos el peso
            if (archivoPeso > pesoLimite) {
                miInput.setCustomValidity('Demasiado grande');
            }
        }

        miInput.addEventListener("input", validarImagen);

    </script>
</body>

</html>